// Copyright (c) 2023-present Lukas Neubert and contributors (see AUTHORS.md).
// This Source Code Form is subject to the terms of the Mozilla Public License 2.0.
package main

import os

const WIN_SKIP := [
	'lib\\bait\\tests\\inout_runner_test.bt'
]

fun main() {
	mut test_files := os.walk_ext('lib', '.bt').filter(fun (f string) bool {
		return f.contains('_test.') and not f.contains('.in.')
	}) as []string
	mut fails := 0

	if os.platform() == 'win32' {
		test_files = test_files.filter(fun (f string) bool {
			return not WIN_SKIP.contains(f)
		}) as []string
	}

	for file in test_files {
		fails += os.system('node ${$BAITEXE} test ${file}')
	}

	if fails > 0 {
		exit(1)
	}
}
