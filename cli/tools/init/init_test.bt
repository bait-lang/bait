// SPDX-FileCopyrightText: 2023-present Lukas Neubert <lukas.neubert@proton.me>
// SPDX-License-Identifier: MPL-2.0

import os
import bait.util.testing

const TMP := os.tmp_dir() + '/bait'

fun testsuite_begin() {
	os.mkdir(TMP)
	os.chdir(TMP)
}

fun test_with_name() {
	res := os.system('node ${$BAITEXE} init with_name')
	assert res == 0

	assert os.exists_dir('${TMP}/with_name/src')
	assert os.ls('${TMP}/with_name').length == 6
}

fun test_dot() {
	os.mkdir('dot')
	os.chdir('dot')

	res := os.system('node ${$BAITEXE} init .')
	assert res == 0

	assert os.exists_dir('${TMP}/dot/src')
	assert os.ls('${TMP}/dot').length == 6

	os.chdir(TMP)
}

fun test_template_option() {
	res := os.system('node ${$BAITEXE} init -t lib mylib')
	assert res == 0

	assert os.ls('${TMP}/mylib').length == 7
}

fun testsuite_end() {
	os.rmdir_all(TMP)
}
